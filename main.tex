\documentclass[12pt,a4paper]{report}

% --- PDFLATEX COMPATIBLE PREAMBLE ---
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[margin=1in]{geometry}
\usepackage{newtxtext,newtxmath}
\usepackage{tfrupee} % Added for the \rupee command
% --- END PREAMBLE BLOCK ---

% Packages
\usepackage{setspace}
\usepackage{tocloft}
\usepackage{titlesec}
\usepackage{fancyhdr}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{graphicx} % Needed for images
\graphicspath{{assets/}}
\usepackage{amsmath}
\usepackage{multirow}
\usepackage{longtable}
\usepackage{array}
\usepackage{lipsum} % For dummy text if needed, can be removed later
\usepackage{xurl} % Allows arbitrary line breaks in URLs, fixing Underfull \hbox errors

% Page setup
\onehalfspacing
\setlength{\parindent}{0.5in}
\setlength{\parskip}{0pt}


% Header and footer setup using fancyhdr
\pagestyle{fancy} % Set the default page style to fancy
\fancyhf{} % Clear existing header/footer
\fancyhead[R]{% Right Header
	\ifnum\value{page}>0 % Condition: From page 2 onwards
	\includegraphics[height=1.5cm]{header.png}
	\fi
}
\fancyhead[L]{\leftmark} % Chapter title on the left header
\fancyfoot[C]{%
	% Use a parbox to stack the page number and image
	\parbox{\linewidth}{%
		\centering % Center the contents of the parbox
		\thepage\\[5pt] % The page number, followed by a line break and 5pt of space
		% Use a makebox of 0pt width to let the image span the full page width
		% without affecting the centering. The image itself is centered on the page.
		\ifnum\value{page}>3
		\makebox[0pt][c]{\includegraphics[width=\paperwidth]{footer.png}}
		\fi
	}%
}
\renewcommand{\headrulewidth}{0pt} % Remove header rule
\renewcommand{\footrulewidth}{0pt} % Remove footer rule for full-width image
\setlength{\headheight}{48pt}% Increased headheight to accommodate image placeholder

% Apply fancy style to chapter pages as well (overrides default 'plain')
\fancypagestyle{plain}{%
	\fancyhead[R]{% Right Header
		\ifnum\value{page}>0
		\includegraphics[height=1.5cm]{header.png}
		\fi
	}
	\fancyfoot[C]{%
		% Use a parbox to stack the page number and image
		\parbox{\linewidth}{%
			\centering % Center the contents of the parbox
			\thepage\\[5pt] % The page number, followed by a line break and 5pt of space
			% Use a makebox of 0pt width to let the image span the full page width
			% without affecting the centering. The image itself is centered on the page.
			\ifnum\value{page}>3
			\makebox[0pt][c]{\includegraphics[width=\paperwidth]{footer.png}}
			\fi
		}%
	}
	% Remove the footer rule, as the full-width image replaces it
	\renewcommand{\footrulewidth}{0pt} 
}

% Chapter and section formatting (Heading 1 equivalent)
% Numbered chapters (\chapter)
\titleformat{\chapter}[display]
{\normalfont\huge\bfseries\centering} % Centered, huge, bold
{\chaptertitlename\ \thechapter} % "Chapter X"
{20pt} % Space between number and title
{\Huge} % Title font size
\titlespacing*{\chapter}{0pt}{20pt}{40pt} % Spacing around chapter title (adjusted top spacing)

% Unnumbered chapters (\chapter*) - Make them look similar
\titleformat{name=\chapter, numberless}[display]
{\normalfont\huge\bfseries\centering} % Centered, huge, bold
{} % No chapter number text
{0pt} % No space needed
{\Huge} % Title font size
\titlespacing*{name=\chapter, numberless}{0pt}{20pt}{40pt} % Same spacing

% Section formatting (Heading 2 equivalent)
\titleformat{\section}
{\normalfont\Large\bfseries} % Large, bold
{\thesection} % Section number "X.Y"
{1em} % Space between number and title
{} % Code before title (empty)
\titlespacing*{\section}{0pt}{3.5ex plus 1ex minus.2ex}{2.3ex plus.2ex} % Default spacing

% Subsection formatting (Heading 3 equivalent)
\titleformat{\subsection}
{\normalfont\large\bfseries} % large, bold
{\thesubsection} % Subsection number "X.Y.Z"
{1em} % Space between number and title
{} % Code before title (empty)
\titlespacing*{\subsection}{0pt}{3.25ex plus 1ex minus.2ex}{1.5ex plus.2ex} % Default spacing


% Code listing setup
\lstset{
	basicstyle=\ttfamily\small,
	breaklines=true,
	frame=single,
	numbers=left,
	numberstyle=\tiny,
	backgroundcolor=\color{gray!10}
}

% Hyperref setup (Moved to be the LAST package loaded)
\usepackage{hyperref}
\usepackage[nohyperlinks]{acronym}
\hypersetup{
	colorlinks=true,
	linkcolor=black,
	citecolor=blue,
	urlcolor=blue,
	pdftitle={FIRMAI: AI-Powered IoT Firmware Vulnerability Analyzer},
	pdfauthor={Abhiram G Nair, Navomi Titus, Spandana Nair, Vignesh S Kumar}
}

\begin{document}

% Front matter
\include{frontmatter/titlepage}
\include{frontmatter/certificate}
\include{frontmatter/declaration}
\include{frontmatter/acknowledgements}
\include{frontmatter/abstract}

% Table of Contents
\cleardoublepage % Ensures ToC starts on an odd page, applying fancy style
	\tableofcontents

% List of Figures
\cleardoublepage
\listoffigures
\addcontentsline{toc}{chapter}{List of Figures} % Add LoF to ToC

% List of Tables
\cleardoublepage
\listoftables
\addcontentsline{toc}{chapter}{List of Tables} % Add LoT to ToC

% List of Abbreviations
\cleardoublepage
\include{frontmatter/abbreviations}

% Main Chapters
\cleardoublepage % Start main content on an odd page
% Switch back to Arabic numerals for main content
\pagenumbering{arabic}
\setcounter{page}{1}

\include{chapters/ch1_introduction}
\include{chapters/ch2_literature_review}
\include{chapters/ch3_system_analysis}
\include{chapters/ch4_methodology}
\include{chapters/ch5_system_implementation}
\include{chapters/ch6_testing_and_results}
\include{chapters/ch7_conclusions}

\include{chapters/appendices}

% Bibliography
\bibliographystyle{plain}
\bibliography{references}

\end{document}
